<!DOCTYPE html>
<html>
<head>
  <style>
    body {
      font-family: 'Inter', sans-serif;
      margin: 0;
      padding: 16px;
    }
    
    #preview-container {
      width: 100%;
      height: 200px;
      background: #f0f0f0;
      border-radius: 8px;
      margin-bottom: 20px;
      position: relative;
      overflow: hidden;
    }
    
    #preview-canvas {
      width: 100%;
      height: 100%;
    }
    
    .control-group {
      margin-bottom: 20px;
    }
    
    .control-label {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
      font-size: 12px;
      color: #333;
    }
    
    .control-name {
      font-weight: 500;
    }
    
    .control-value {
      color: #666;
    }
    
    input[type="range"] {
      width: 100%;
      height: 8px;
      border-radius: 4px;
      background: #e0e0e0;
      outline: none;
      -webkit-appearance: none;
    }
    
    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 16px;
      height: 16px;
      border-radius: 8px;
      background: #18a0fb;
      cursor: pointer;
    }
    
    input[type="range"]::-moz-range-thumb {
      width: 16px;
      height: 16px;
      border-radius: 8px;
      background: #18a0fb;
      cursor: pointer;
      border: none;
    }
    
    .controls-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }
    
    .button-group {
      display: flex;
      gap: 8px;
      margin-top: 20px;
    }
    
    button {
      flex: 1;
      padding: 10px;
      border: none;
      border-radius: 6px;
      font-size: 12px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    #generate {
      background: #18a0fb;
      color: white;
    }
    
    #generate:hover {
      background: #0d7fd6;
    }
    
    #cancel {
      background: #f0f0f0;
      color: #333;
    }
    
    #cancel:hover {
      background: #e0e0e0;
    }
  </style>
</head>
<body>
  <div id="preview-container">
    <canvas id="preview-canvas"></canvas>
  </div>
  
  <div class="controls-row">
    <div class="control-group">
      <div class="control-label">
        <span class="control-name">Wave Length</span>
        <span class="control-value" id="waveLength-value">100px</span>
      </div>
      <input type="range" id="waveLength" min="20" max="300" value="100">
    </div>
    
    <div class="control-group">
      <div class="control-label">
        <span class="control-name">Wave Height</span>
        <span class="control-value" id="waveHeight-value">50px</span>
      </div>
      <input type="range" id="waveHeight" min="10" max="200" value="50">
    </div>
  </div>
  
  <div class="controls-row">
    <div class="control-group">
      <div class="control-label">
        <span class="control-name">Wave Roundness</span>
        <span class="control-value" id="waveRoundness-value">50%</span>
      </div>
      <input type="range" id="waveRoundness" min="0" max="100" value="50">
    </div>

    <div class="control-group">
      <div class="control-label">
        <span class="control-name">Wave Offset</span>
        <span class="control-value" id="waveOffset-value">0%</span>
      </div>
      <input type="range" id="waveOffset" min="-100" max="100" value="0">
    </div>
  </div>

  <div class="controls-row">
    <div class="control-group">
      <div class="control-label">
        <span class="control-name">Number of Waves</span>
        <span class="control-value" id="numWaves-value">4</span>
      </div>
      <input type="range" id="numWaves" min="1" max="10" value="4">
    </div>
  </div>
  
  <div class="button-group">
    <button id="generate">Generate</button>
    <button id="cancel">Cancel</button>
  </div>

  <script>
    const canvas = document.getElementById('preview-canvas');
    const ctx = canvas.getContext('2d');
    
    // Set canvas size to match container
    function resizeCanvas() {
      canvas.width = canvas.offsetWidth;
      canvas.height = canvas.offsetHeight;
    }
    resizeCanvas();
    window.addEventListener('resize', resizeCanvas);
    
    // Slider controls
    const waveLengthSlider = document.getElementById('waveLength');
    const waveHeightSlider = document.getElementById('waveHeight');
    const waveRoundnessSlider = document.getElementById('waveRoundness');
    const waveOffsetSlider = document.getElementById('waveOffset');
    const numWavesSlider = document.getElementById('numWaves');

    // Value displays
    const waveLengthValue = document.getElementById('waveLength-value');
    const waveHeightValue = document.getElementById('waveHeight-value');
    const waveRoundnessValue = document.getElementById('waveRoundness-value');
    const waveOffsetValue = document.getElementById('waveOffset-value');
    const numWavesValue = document.getElementById('numWaves-value');

    // Initialize with default values
    let params = {
      waveLength: parseInt(waveLengthSlider.value),
      waveHeight: parseInt(waveHeightSlider.value),
      waveRoundness: parseInt(waveRoundnessSlider.value),
      waveOffset: parseInt(waveOffsetSlider.value),
      numWaves: parseInt(numWavesSlider.value)
    };
    
    // Update value displays
    function updateValues() {
      waveLengthValue.textContent = params.waveLength + 'px';
      waveHeightValue.textContent = params.waveHeight + 'px';
      waveRoundnessValue.textContent = params.waveRoundness + '%';
      waveOffsetValue.textContent = params.waveOffset + '%';
      numWavesValue.textContent = params.numWaves;
    }
    
    // Event listeners
    waveLengthSlider.addEventListener('input', (e) => {
      params.waveLength = parseInt(e.target.value);
      updateValues();
      drawWave();
    });
    
    waveHeightSlider.addEventListener('input', (e) => {
      params.waveHeight = parseInt(e.target.value);
      updateValues();
      drawWave();
    });
    
    waveRoundnessSlider.addEventListener('input', (e) => {
      params.waveRoundness = parseInt(e.target.value);
      updateValues();
      drawWave();
    });
    
    waveOffsetSlider.addEventListener('input', (e) => {
      params.waveOffset = parseInt(e.target.value);
      updateValues();
      drawWave();
    });

    numWavesSlider.addEventListener('input', (e) => {
      params.numWaves = parseInt(e.target.value);
      updateValues();
      drawWave();
    });

    // Draw the wave preview
    function drawWave() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      
      const centerY = canvas.height / 2;
      const padding = 50;
      const startX = padding;
      const endX = canvas.width - padding;

      // Scale the wave to fit in preview
      const totalWaveLength = params.waveLength * params.numWaves;
      const scaleFactor = Math.min((endX - startX) / totalWaveLength, (canvas.height - padding * 2) / (params.waveHeight * 2));
      const scaledWaveLength = params.waveLength * scaleFactor;
      const scaledWaveHeight = params.waveHeight * scaleFactor;
      
      ctx.strokeStyle = '#18a0fb';
      ctx.lineWidth = 2;
      ctx.beginPath();
      
      // Wave configuration
      const topY = centerY - scaledWaveHeight;
      const bottomY = centerY + scaledWaveHeight;
      const offsetPercent = params.waveOffset / 100;
      const roundnessPercent = params.waveRoundness / 100;
      
      // Start at bottom left
      ctx.moveTo(startX, bottomY);
      
      // Draw each wave segment
      for (let i = 0; i < params.numWaves; i++) {
        const waveStartX = startX + i * scaledWaveLength;
        const waveMidX = waveStartX + scaledWaveLength / 2;
        const waveEndX = waveStartX + scaledWaveLength;
        
        // Top point position (with offset)
        const topXOffset = offsetPercent * scaledWaveLength;
        const topX = waveMidX + topXOffset;
        
        // Calculate bezier handles based on roundness
        // Roundness determines how far along toward the next point the handles reach
        const handleReach = roundnessPercent * (scaledWaveLength / 2);
        
        // First curve: bottom to top
        const cp1x = waveStartX + handleReach;
        const cp1y = bottomY;
        const cp2x = topX - handleReach;
        const cp2y = topY;
        
        ctx.bezierCurveTo(cp1x, cp1y, cp2x, cp2y, topX, topY);
        
        // Second curve: top to bottom
        const cp3x = topX + handleReach;
        const cp3y = topY;
        const cp4x = waveEndX - handleReach;
        const cp4y = bottomY;
        
        ctx.bezierCurveTo(cp3x, cp3y, cp4x, cp4y, waveEndX, bottomY);
      }
      
      ctx.stroke();
    }
    
    // Initial draw
    drawWave();
    
    // Generate button
    document.getElementById('generate').onclick = () => {
      parent.postMessage({ pluginMessage: { type: 'generate-wave', params } }, '*');
    };
    
    // Cancel button
    document.getElementById('cancel').onclick = () => {
      parent.postMessage({ pluginMessage: { type: 'cancel' } }, '*');
    };
  </script>
</body>
</html>
